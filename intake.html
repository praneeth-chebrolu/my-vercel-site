<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>OSF Cancer Clinical Trials | Intake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 60px auto;
      padding: 0 20px;
      line-height: 1.6;
      color: #1f2937;
    }
    header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
    }
    nav a {
      margin-left: 14px;
      text-decoration: none;
      color: #1f2937;
    }
    nav a:hover { text-decoration: underline; }

    .card {
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 18px;
      margin-top: 16px;
      background: #ffffff;
    }

    label { display:block; margin-top: 10px; }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      margin: 6px 0 12px;
      box-sizing: border-box;
    }

    .readonly {
      background: #f9fafb;
    }

    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover { background: #f3f4f6; }

    #msg { margin-top: 12px; font-weight: 600; }

    .muted { color: #6b7280; font-size: 14px; }

    .matchBox {
      border: 1px dashed #d1d5db;
      border-radius: 10px;
      padding: 10px;
      margin-top: -6px;
      margin-bottom: 12px;
      background: #fcfcfd;
    }

    .pill {
      display:inline-block;
      font-size: 12px;
      border: 1px solid #d1d5db;
      border-radius: 999px;
      padding: 4px 10px;
      background: #f9fafb;
      margin-top: 6px;
    }
  </style>
</head>

<body>
<header>
  <h1>OSF Cancer Clinical Trials</h1>
  <nav>
    <a href="index.html">Cancer Types</a>
    <a href="trials.html">Trial List</a>
    <a href="intake.html">Intake</a>
  </nav>
</header>

<section class="card">
  <h2>Find a clinical trial</h2>
  <p class="muted">Share a few details and we’ll guide you to the next step.</p>

  <form id="trialForm">
    <label>
      Selected trial
      <input id="selectedTrial" name="selectedTrial" class="readonly" readonly>
    </label>

    <label>
      Your name
      <input name="name" required>
    </label>

    <!-- NEW: Free-text cancer field + smart matching -->
    <label>
      Cancer (type anything)
      <input id="cancerFreeText" name="cancerFreeText" placeholder="Example: ovarian cancer, GBM, melanoma, colon tumor, etc." required list="cancerExamples">
      <datalist id="cancerExamples">
        <option value="Ovarian cancer"></option>
        <option value="Cervical cancer"></option>
        <option value="Endometrial cancer"></option>
        <option value="Glioblastoma (GBM)"></option>
        <option value="Non-small cell lung cancer (NSCLC)"></option>
        <option value="Small cell lung cancer"></option>
        <option value="Breast cancer"></option>
        <option value="Melanoma"></option>
        <option value="Colon cancer"></option>
        <option value="Rectal cancer"></option>
        <option value="Prostate cancer"></option>
        <option value="Kidney cancer"></option>
        <option value="Bladder cancer"></option>
        <option value="Head and neck cancer"></option>
        <option value="Testicular cancer"></option>
        <option value="Childhood cancer"></option>
      </datalist>
    </label>

    <div class="matchBox">
      <div class="muted">Best match (used to route/filter trials):</div>
      <div id="matchText" style="font-weight:700;">Not matched yet</div>
      <div id="matchConfidence" class="pill" style="display:none;"></div>
    </div>

    <!-- Hidden field to store the matched category -->
    <input type="hidden" id="cancerCategoryMatched" name="cancerCategoryMatched" value="">

    <label>
      City and state (example: Peoria, IL)
      <input name="location" required>
    </label>

    <label>
      Contact information (email or phone)
      <input name="contact" placeholder="Example: email@example.com or (555) 555-5555">
    </label>

    <button type="submit">Submit</button>
  </form>

  <p id="msg"></p>
</section>

<section class="card">
  <h2>How it works</h2>
  <ol>
    <li>Tell us your cancer type and location.</li>
    <li>We match you to trials that are open and recruiting.</li>
    <li>A coordinator follows up with next steps.</li>
  </ol>
</section>

<section class="card">
  <h2>Contact Us</h2>
  <p>
    Phone: <a href="tel:+18446734467">(844) 673-4467</a><br>
    OR<br>
    Email: <a href="mailto:sfmc.clinicaltrials@osfhealthcare.org">sfmc.clinicaltrials@osfhealthcare.org</a>
  </p>
</section>

<script>
  // ----------------------------
  // 1) Selected trial from URL
  // intake.html?trial=NCT06890338
  // ----------------------------
  (function fillSelectedTrialFromUrl() {
    const selectedTrialInput = document.getElementById("selectedTrial");
    const params = new URLSearchParams(window.location.search);
    const trialFromUrl = params.get("trial");
    selectedTrialInput.value = trialFromUrl ? trialFromUrl : "Not selected (please choose a trial first)";
  })();

  // ----------------------------
  // 2) Cancer matching
  // Goal: Patient types anything -> match to your site categories.
  // NOTE: True SNOMED/OMOP coding requires a terminology service.
  // This is a lightweight on-page matcher using synonyms.
  // ----------------------------
  const CANCER_CATEGORIES = [
    "Bladder cancer",
    "Brain cancer",
    "Breast cancer",
    "Childhood cancer",
    "Colon & rectal cancer",
    "Gastrointestinal cancer",
    "Gynecologic cancer",
    "Head & neck cancer",
    "Kidney cancer",
    "Lung cancer",
    "Prostate cancer",
    "Skin cancer",
    "Testicular cancer"
  ];

  // Synonyms/keywords per category (expand anytime)
  const SYNONYMS = {
    "Bladder cancer": [
      "bladder", "urothelial", "transitional cell", "urothelial carcinoma"
    ],
    "Brain cancer": [
      "brain", "glioblastoma", "gbm", "glioma", "astrocytoma", "oligodendroglioma", "meningioma", "cns"
    ],
    "Breast cancer": [
      "breast", "brca", "ductal", "lobular", "triple negative", "her2"
    ],
    "Childhood cancer": [
      "child", "pediatric", "paediatric", "neuroblastoma", "wilms", "rhabdomyosarcoma", "ewing", "acute lymphoblastic leukemia", "all", "acute myeloid leukemia", "aml"
    ],
    "Colon & rectal cancer": [
      "colon", "colorectal", "rectal", "crc", "sigmoid", "adenocarcinoma colon", "adenocarcinoma rectum"
    ],
    "Gastrointestinal cancer": [
      "gi", "gastrointestinal", "stomach", "gastric", "esophageal", "esophagus", "pancreas", "pancreatic", "liver", "hepatocellular", "hcc", "bile duct", "cholangiocarcinoma", "small bowel", "duodenum"
    ],
    "Gynecologic cancer": [
      "gynecologic", "gyn", "ovarian", "fallopian", "peritoneal", "uterine", "endometrial", "cervical", "vulvar", "vaginal"
    ],
    "Head & neck cancer": [
      "head and neck", "head & neck", "oral", "mouth", "tongue", "throat", "larynx", "laryngeal", "pharynx", "nasopharyngeal", "oropharyngeal", "hpv"
    ],
    "Kidney cancer": [
      "kidney", "renal", "rcc", "renal cell", "clear cell renal"
    ],
    "Lung cancer": [
      "lung", "nsclc", "non small cell", "non-small cell", "small cell", "sclc", "adenocarcinoma lung", "squamous lung"
    ],
    "Prostate cancer": [
      "prostate", "psa", "castration resistant", "mcrpc"
    ],
    "Skin cancer": [
      "skin", "melanoma", "basal cell", "squamous cell skin", "merkel"
    ],
    "Testicular cancer": [
      "testicular", "testis", "germ cell", "seminoma", "nonseminoma"
    ]
  };

  function normalize(s) {
    return (s || "")
      .toLowerCase()
      .replace(/[’']/g, "'")
      .replace(/[^a-z0-9\s&-]/g, " ")
      .replace(/\s+/g, " ")
      .trim();
  }

  function scoreMatch(input, category) {
    const txt = normalize(input);
    if (!txt) return 0;

    // Direct contains category words
    const catTxt = normalize(category);
    let score = 0;

    // Big boost if category keyword is included
    if (txt.includes(catTxt.replace(" cancer",""))) score += 6;

    // Synonym hits
    const syns = SYNONYMS[category] || [];
    for (const syn of syns) {
      const s = normalize(syn);
      if (!s) continue;
      if (txt.includes(s)) score += 4;
    }

    // Small boost for partial word overlaps
    const words = txt.split(" ");
    const catWords = catTxt.split(" ");
    for (const w of words) {
      if (w.length >= 4 && catWords.includes(w)) score += 1;
    }

    return score;
  }

  function bestCategoryMatch(input) {
    let best = { category: "", score: 0 };
    for (const c of CANCER_CATEGORIES) {
      const sc = scoreMatch(input, c);
      if (sc > best.score) best = { category: c, score: sc };
    }
    return best;
  }

  const cancerFreeTextEl = document.getElementById("cancerFreeText");
  const matchTextEl = document.getElementById("matchText");
  const matchConfEl = document.getElementById("matchConfidence");
  const matchedHiddenEl = document.getElementById("cancerCategoryMatched");

  function updateMatchUI() {
    const input = cancerFreeTextEl.value;
    const best = bestCategoryMatch(input);

    if (!input.trim()) {
      matchTextEl.textContent = "Not matched yet";
      matchConfEl.style.display = "none";
      matchedHiddenEl.value = "";
      return;
    }

    // You can tune these thresholds
    if (best.score >= 4) {
      matchTextEl.textContent = best.category;
      matchedHiddenEl.value = best.category;

      matchConfEl.style.display = "inline-block";
      matchConfEl.textContent = best.score >= 10 ? "High match" : "Possible match";
    } else {
      matchTextEl.textContent = "Could not confidently match (we will review)";
      matchedHiddenEl.value = "";

      matchConfEl.style.display = "inline-block";
      matchConfEl.textContent = "Low match";
    }
  }

  cancerFreeTextEl.addEventListener("input", updateMatchUI);
  updateMatchUI();

  // ----------------------------
  // 3) Submit (demo)
  // ----------------------------
  const form = document.getElementById("trialForm");
  const msg = document.getElementById("msg");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const data = new FormData(form);
    const name = data.get("name");
    const cancerFreeText = data.get("cancerFreeText");
    const matchedCategory = data.get("cancerCategoryMatched");
    const location = data.get("location");
    const trial = data.get("selectedTrial");

    msg.textContent =
      `Thanks, ${name}. We received your request for "${cancerFreeText}"` +
      (matchedCategory ? ` (matched to: ${matchedCategory}).` : ".") +
      ` Location: ${location}. Selected trial: ${trial}.`;

    // IMPORTANT: do NOT reset selectedTrial; keep it visible
    const selectedTrialValue = document.getElementById("selectedTrial").value;
    form.reset();
    document.getElementById("selectedTrial").value = selectedTrialValue;

    // also re-run match display (since reset clears it)
    updateMatchUI();
  });
</script>

</body>
</html>
